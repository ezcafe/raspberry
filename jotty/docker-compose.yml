services:
  jotty:
    image: ghcr.io/fccview/jotty:latest
    container_name: jotty
    restart: unless-stopped
    environment:
      - NODE_ENV=${NODE_ENV}
      - TZ=${TZ}
      - HTTPS=true
      - SERVE_PUBLIC_IMAGES=yes
      - SERVE_PUBLIC_FILES=yes
      - APP_URL=${APP_URL}
      - SSO_MODE=oidc
      - SSO_FALLBACK_LOCAL=true
      - OIDC_ISSUER=${OIDC_ISSUER}
      - OIDC_CLIENT_ID=${OIDC_CLIENT_ID}
      - OIDC_CLIENT_SECRET=${OIDC_CLIENT_SECRET}
      - PUID=1000    # your actual UID from id -u
      - PGID=1000    # your actual GID from id -g
    user: "1000:1000"
    ports:
      - ${PORT}:3000
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/api/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"]
      interval: 30s
      timeout: 10s
      start_period: 40s
      retries: 3
    volumes:
      # This stores your checklists, notes, users, and settings.
      # mkdir -p ~/backups/database/jotty && cd ~/backups/database/jotty && mkdir -p config data/users data/checklists data/notes data/sharing data/encryption cache
      # sudo chown -R 1000:1000 data/ && sudo chown -R 1000:1000 config/ && sudo chown -R 1000:1000 cache/
      - ${HOME}/backups/jotty/data:/app/data:rw
      # This contains custom themes and configuration files.
      - ${HOME}/backups/jotty/config:/app/config:rw
      # Improves performance by persisting cache between container restarts.
      - ${HOME}/backups/jotty/cache:/app/.next/cache:rw
    platform: linux/arm64
networks: {}
