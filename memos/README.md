# memos

## Pocket ID

### Create Provider

Go to your auth provider
Create OIDC Client with these information

- name: memos
- Callback URLs: https://note.example.com/auth/callback

### Update memos config

Go to Settings -> SSO -> Create
- Name: Passkey
- Client ID: copy from OIDC provider
- Client secret: copy from OIDC provider
- Authorization endpoint: copy from OIDC provider
- Token endpoint: copy from OIDC provider
- User endpoint: copy from OIDC provider
- Scopes: openid profile email
- Identifier: preferred_username

## Authentik

### Create Provider

- Select `OAuth2/OpenID Provider`
- Name: `Memos`
- Authentication flow: default-authentication-flow (Welcome to authentik!)
- Authorization flow: default-provider-authorization-implicit-consent (Authorize Application)
- Client type: Confidential
- Client ID: <auto-generated>
- Client Secret: <auto-generated>
- Redirect URIs/Origins (RegEx): https://<your-memos-domain>/auth/callback
- Signing Key: `authentik Self-signed Certificate`

### Create Application

- Name: `Memos`
- Slug: `memos`
- Group: `selfhosted`
- Provider: <select-created-memos-provider>
- Policy engine mode: any

### Update memos config

- Go to memos app
- Settings -> SSO -> Create
- Type: OAUTH2
- Template: Custom
- Name: `OpenID Connect`
- Client ID: <auto-generated>
- Client secret: <auto-generated>
- Authorization endpoint: https://<your-auth-domain>/application/o/authorize/
- Token endpoint: https://<your-auth-domain>/application/o/token/
- User endpoint: https://<your-auth-domain>/application/o/userinfo/
- Scopes: `openid email profile`
- Identifier: `preferred_username`

### Allow user signup

- Go to memos app
- Settings -> System -> Allow user signup -> Check

### Create account

- Logout current user
- `Sign in with OpenID Connect`

### Disable user signup after Sign in with OpenID Connect

- Go to memos app
- Settings -> System -> Allow user signup -> Uncheck

## Backup and Restore

### Make .sh script as executable

chmod +x ../scripts/backup-post-script.sh

### Manual Backup

<!-- https://github.com/tiredofit/docker-db-backup -->

```
docker exec -it memos-db-backup bash
backup-now
```

### Restore

```
docker exec -it memos-db-backup bash
restore
```
